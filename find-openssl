#!/usr/bin/env bash
# Check if CMake is installed
if ! command -v cmake &> /dev/null
then
    echo "CMake is not installed. Please install CMake and try again."
    exit 1
fi

# Create a temporary directory
temp_dir=$(mktemp -d)
cd "$temp_dir"

# Create a CMakeLists.txt file
cat > CMakeLists.txt << EOL
cmake_minimum_required(VERSION 3.10)
project(FindOpenSSL)
find_package(OpenSSL REQUIRED)
add_custom_target(print_openssl_include_dir
    COMMAND \${CMAKE_COMMAND} -E echo \${OPENSSL_INCLUDE_DIR} > openssl_include_dir.txt
)
EOL

# Run CMake
cmake . &> /dev/null

# Run the custom target to print the OpenSSL directory
cmake --build . --target print_openssl_include_dir &> /dev/null
openssl_include_dir=$(cat openssl_include_dir.txt)
openssl_dir=$(dirname "$openssl_include_dir")
echo $openssl_dir

# Clean up
cd ..
rm -rf "$temp_dir"
